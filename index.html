<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cover Letter Generator - Jan Skaaden</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        h1 { color: #1a1a1a; margin-bottom: 8px; }
        .subtitle { color: #666; margin-bottom: 32px; }
        .card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .card h2 { margin-top: 0; font-size: 18px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; color: #444; }
        .label-hint { font-weight: normal; color: #666; font-size: 13px; }
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        textarea:focus, input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #94a3b8; cursor: wait; }
        .btn-secondary {
            background: #6366f1;
            margin-top: 8px;
        }
        .btn-secondary:hover { background: #4f46e5; }
        .inference {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .inference.visible { display: block; }
        .inference h3 { margin: 0 0 16px 0; font-size: 15px; color: #92400e; }
        .inference-section { margin-bottom: 16px; }
        .inference-section:last-child { margin-bottom: 0; }
        .inference-section strong { display: block; font-size: 12px; color: #78350f; text-transform: uppercase; margin-bottom: 6px; }
        .inference-section p { margin: 0; font-size: 14px; color: #451a03; }
        .output { display: none; }
        .output.visible { display: block; }
        #coverLetter {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.8;
            background: #fafafa;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            min-height: 300px;
        }
        #coverLetter[contenteditable]:focus {
            outline: none;
            border-color: #2563eb;
            background: white;
        }
        .actions { display: flex; gap: 12px; margin-top: 16px; }
        .actions button { flex: 1; }
        .copy-btn { background: #059669; }
        .copy-btn:hover { background: #047857; }
        .edit-hint { font-size: 13px; color: #666; margin-bottom: 8px; }
        .guidelines {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .guidelines strong { color: #166534; }
        .guidelines ul { margin: 8px 0 0 0; padding-left: 20px; color: #15803d; }
        .fetch-status {
            font-size: 13px;
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            display: none;
        }
        .fetch-status.loading { display: block; background: #dbeafe; color: #1e40af; }
        .fetch-status.success { display: block; background: #dcfce7; color: #166534; }
        .fetch-status.error { display: block; background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <h1>Cover Letter Generator</h1>
    <p class="subtitle">Narrative-driven cover letters that interpret your experience, not repeat it</p>

    <div class="guidelines">
        <strong>‚úì This tool follows these principles:</strong>
        <ul>
            <li>Sharp opening‚Äîno filler introductions</li>
            <li>Connects your experience to their actual problems, not just stated skills</li>
            <li>Specific examples and outcomes, not buzzwords</li>
            <li>Explains fit even when title isn't a perfect match</li>
            <li>Written for a skeptical reader with 60 seconds</li>
            <li>No "passionate," "results-driven," "excited to apply," or corporate fluff</li>
        </ul>
    </div>

    <div class="card">
        <h2>1. Company & Role</h2>
        <div class="row-3">
            <div>
                <label for="company">Company Name *</label>
                <input type="text" id="company" placeholder="e.g., Spotify">
            </div>
            <div>
                <label for="role">Role Title *</label>
                <input type="text" id="role" placeholder="e.g., Growth PM">
            </div>
            <div>
                <label for="companyUrl">Company Website <span class="label-hint">(optional)</span></label>
                <input type="url" id="companyUrl" placeholder="https://company.com/about">
            </div>
        </div>
        <button class="btn-secondary" onclick="fetchCompanyInfo()" id="fetchBtn">üîç Fetch Company Info</button>
        <div id="fetchStatus" class="fetch-status"></div>
    </div>

    <div class="card">
        <h2>2. Job Description *</h2>
        <label for="jobDesc">Paste the full job posting</label>
        <textarea id="jobDesc" rows="10" placeholder="Paste the job description here..."></textarea>
    </div>

    <div class="card">
        <h2>3. Company Context <span class="label-hint">(auto-filled if URL provided, or paste manually)</span></h2>
        <label for="companyContext">What does the company do? Mission, product, stage, culture...</label>
        <textarea id="companyContext" rows="4" placeholder="e.g., Series B fintech building spending analytics for SMBs. Mission is to help small businesses understand their cash flow. Engineering-led culture, remote-first..."></textarea>
    </div>

    <div class="card">
        <button onclick="generateLetter()">‚ú® Generate Cover Letter</button>
    </div>

    <div id="inference" class="inference">
        <h3>üß† Before writing, here's my read on this role:</h3>
        <div class="inference-section">
            <strong>What this role actually values (beyond the bullet points)</strong>
            <p id="inferValues"></p>
        </div>
        <div class="inference-section">
            <strong>Problems this hire is likely meant to solve</strong>
            <p id="inferProblems"></p>
        </div>
        <div class="inference-section">
            <strong>Why your background fits (the non-obvious angle)</strong>
            <p id="inferFit"></p>
        </div>
    </div>

    <div id="output" class="output">
        <div class="card">
            <h2>Your Cover Letter</h2>
            <p class="edit-hint">üí° Click to edit. This is a strong draft‚Äîpersonalize details you know better.</p>
            <div id="coverLetter" contenteditable="true"></div>
            <div class="actions">
                <button class="copy-btn" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
                <button onclick="downloadPDF()" style="background: #dc2626;">üìÑ Download PDF</button>
                <button onclick="generateLetter()" style="background: #6366f1;">üîÑ Regenerate</button>
            </div>
        </div>
    </div>

    <script>
        // =====================================================================
        // COMPANY WEBSITE FETCHING (via public CORS proxy)
        // =====================================================================

        async function fetchCompanyInfo() {
            const url = document.getElementById('companyUrl').value.trim();
            const status = document.getElementById('fetchStatus');
            const btn = document.getElementById('fetchBtn');

            if (!url) {
                status.className = 'fetch-status error';
                status.textContent = 'Please enter a company URL first';
                return;
            }

            btn.disabled = true;
            status.className = 'fetch-status loading';
            status.textContent = 'Fetching company info...';

            try {
                // Try multiple CORS proxies
                const proxies = [
                    `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                    `https://corsproxy.io/?${encodeURIComponent(url)}`,
                ];

                let html = null;
                for (const proxyUrl of proxies) {
                    try {
                        const response = await fetch(proxyUrl, { timeout: 10000 });
                        if (response.ok) {
                            html = await response.text();
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }

                if (!html) {
                    throw new Error('Could not fetch');
                }

                // Extract useful text
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Remove scripts, styles, nav, footer
                doc.querySelectorAll('script, style, nav, footer, header, noscript').forEach(el => el.remove());

                // Try to find About/Mission content
                let content = '';

                // Look for meta description
                const metaDesc = doc.querySelector('meta[name="description"]');
                if (metaDesc) {
                    content += metaDesc.getAttribute('content') + '\n\n';
                }

                // Look for specific sections
                const selectors = [
                    '[class*="about"]', '[class*="mission"]', '[class*="story"]',
                    '[id*="about"]', '[id*="mission"]', 'main', 'article'
                ];

                for (const selector of selectors) {
                    const el = doc.querySelector(selector);
                    if (el && el.textContent.trim().length > 100) {
                        content += el.textContent.trim().substring(0, 1500) + '\n';
                        break;
                    }
                }

                // Fallback to body text
                if (content.length < 100) {
                    content = doc.body?.textContent?.trim().substring(0, 2000) || '';
                }

                // Clean up
                content = content
                    .replace(/\s+/g, ' ')
                    .replace(/\n\s*\n/g, '\n')
                    .trim()
                    .substring(0, 1500);

                if (content.length > 50) {
                    document.getElementById('companyContext').value = content;
                    status.className = 'fetch-status success';
                    status.textContent = '‚úì Company info fetched. Review and edit as needed.';
                } else {
                    throw new Error('Not enough content found');
                }

            } catch (error) {
                status.className = 'fetch-status error';
                status.textContent = 'Could not fetch automatically. Please paste company info manually (from their About page, etc.)';
            }

            btn.disabled = false;
        }

        // =====================================================================
        // INFERENCE ENGINE - What does this role actually need?
        // =====================================================================

        function inferRoleNeeds(jobDesc, companyContext, role) {
            const jd = jobDesc.toLowerCase();
            const ctx = companyContext.toLowerCase();
            const combined = jd + ' ' + ctx;

            // Infer what they actually value
            let values = [];
            if (/experiment|a\/b|test|hypothesis|data-driven|validate/.test(jd)) {
                values.push("evidence-based decision making over intuition");
            }
            if (/growth|acquisition|retention|funnel|conversion/.test(jd)) {
                values.push("measurable impact on business metrics");
            }
            if (/stakeholder|cross-functional|align|communicate|present/.test(jd)) {
                values.push("ability to influence without authority");
            }
            if (/prioriti|trade-off|focus|backlog|roadmap/.test(jd)) {
                values.push("someone who can say no and explain why");
            }
            if (/fast|move quickly|startup|scrappy|wear many hats/.test(combined)) {
                values.push("bias toward action over perfect analysis");
            }
            if (/scale|growth stage|series [b-d]/.test(combined)) {
                values.push("building processes that work at scale, not just firefighting");
            }
            if (/customer|user|experience|feedback/.test(jd)) {
                values.push("connecting data to real user behavior");
            }
            if (/ambiguity|undefined|figure out|own/.test(jd)) {
                values.push("comfort with ambiguity and self-direction");
            }
            if (values.length === 0) {
                values.push("someone who can translate data into decisions");
            }

            // Infer problems they're trying to solve
            let problems = [];
            if (/growth|conversion|funnel|drop-off/.test(jd)) {
                problems.push("conversion or growth has stalled and they need someone to diagnose why");
            }
            if (/experiment|a\/b|test/.test(jd)) {
                problems.push("they're running experiments but not learning from them systematically");
            }
            if (/prioriti|backlog|roadmap|focus/.test(jd)) {
                problems.push("too many ideas, not enough clarity on what to build next");
            }
            if (/stakeholder|align|cross-functional/.test(jd)) {
                problems.push("teams are making decisions in silos without shared data");
            }
            if (/new|build|establish|first/.test(jd)) {
                problems.push("they're building this function from scratch or early stage");
            }
            if (/scale|process|operationalize/.test(jd)) {
                problems.push("what worked at smaller scale is breaking down");
            }
            if (problems.length === 0) {
                problems.push("they need someone to connect product decisions to measurable outcomes");
            }

            // Infer why Jan's background fits
            let fit = [];
            const isPM = /product manager|product owner/i.test(role);
            const isGrowth = /growth/i.test(role);
            const isAnalyst = /analyst/i.test(role);

            if (isPM) {
                fit.push("Your analytics background means you won't just make decisions‚Äîyou'll make defensible ones backed by data. Many PMs lack this.");
            }
            if (isGrowth) {
                fit.push("You've worked on the measurement side of growth. You know what actually moves metrics vs. what just looks good in a presentation.");
            }
            if (isAnalyst) {
                fit.push("Your product operations experience means you understand the context decisions get made in‚Äînot just the numbers, but the constraints.");
            }
            if (/ecommerce|e-commerce|retail/.test(combined)) {
                fit.push("Direct ecommerce experience at Mytheresa and B&O‚Äîyou've seen high-stakes funnels where small changes have real revenue impact.");
            }
            if (/experiment|a\/b/.test(jd)) {
                fit.push("You've run experiments where the 'obvious' answer was wrong‚Äîand learned to present counterintuitive findings persuasively.");
            }
            if (/stakeholder|cross-functional/.test(jd)) {
                fit.push("You've worked across 5+ regional markets with competing priorities. You know how to build alignment, not just present data.");
            }
            if (fit.length === 0) {
                fit.push("Your background sits at the intersection of analytics and product‚Äîyou understand both the numbers and the decisions they inform.");
            }

            return {
                values: values.slice(0, 3).join("; "),
                problems: problems.slice(0, 2).join("; "),
                fit: fit.slice(0, 2).join(" ")
            };
        }

        // =====================================================================
        // LETTER GENERATION - Narrative, not CV
        // =====================================================================

        function generateLetter() {
            const company = document.getElementById('company').value.trim();
            const role = document.getElementById('role').value.trim();
            const jobDesc = document.getElementById('jobDesc').value.trim();
            const companyContext = document.getElementById('companyContext').value.trim();

            if (!company || !role || !jobDesc) {
                alert('Please fill in company name, role title, and job description.');
                return;
            }

            const jd = jobDesc.toLowerCase();

            // Generate inference
            const inference = inferRoleNeeds(jobDesc, companyContext, role);

            // Show inference
            document.getElementById('inference').classList.add('visible');
            document.getElementById('inferValues').textContent = inference.values;
            document.getElementById('inferProblems').textContent = inference.problems;
            document.getElementById('inferFit').textContent = inference.fit;

            // Determine role type for narrative angle
            const isPM = /product manager|product owner/i.test(role);
            const isGrowth = /growth/i.test(role);

            // =====================================================================
            // BUILD THE LETTER - Section by section
            // =====================================================================

            // OPENING: Sharp, specific, no filler
            let opening = '';
            if (/experiment|a\/b|test/.test(jd)) {
                opening = `The ${role} role at ${company} caught my attention because it seems to treat experimentation as a core competency, not a checkbox. That's the environment I work best in‚Äîwhere decisions get validated before resources get committed.`;
            } else if (isGrowth) {
                opening = `Most growth roles are really reporting roles with a better title. This one at ${company} looks different‚Äîit seems to involve actual ownership of what gets tried and why. That's what I'm looking for.`;
            } else if (isPM) {
                opening = `I've spent four years building the analytical foundation for product decisions. Now I want to own more of the decisions themselves. The ${role} role at ${company} looks like the right place to make that shift.`;
            } else if (/stakeholder|cross-functional/.test(jd)) {
                opening = `What stood out about this ${role} role is the emphasis on working across teams‚Äînot just producing analysis, but making sure it actually influences what gets built. That's where I've had the most impact in my career.`;
            } else if (companyContext && /series [a-c]|startup|early/.test(companyContext.toLowerCase())) {
                opening = `I'm drawn to ${company} because of the stage you're at‚Äîwhere the person in this role will shape how decisions get made, not just execute an existing playbook.`;
            } else {
                opening = `I came across the ${role} position at ${company} and saw a clear fit‚Äînot because my title matches, but because the problems you're trying to solve are ones I've spent four years learning to address.`;
            }

            // CONTEXT: Brief background that sets up the proof
            let context = '';
            if (isPM) {
                context = `My background is in product analytics and operations‚Äîat Mytheresa and Bang & Olufsen, I've been the person helping product teams figure out what to prioritize and why. I know how to frame problems, quantify trade-offs, and present recommendations that hold up to scrutiny. What I haven't had is direct ownership of the roadmap. That's the gap I'm looking to close.`;
            } else if (isGrowth) {
                context = `I've worked on the measurement side of growth for four years‚Äîfunnels, experimentation, tracking, KPIs. At Mytheresa, I'm the one who figures out why conversion moved and what to do about it. At Bang & Olufsen, I helped commercial teams across five markets decide which initiatives to scale and which to cut. I understand how growth actually works, not just how to report on it.`;
            } else {
                context = `My background spans product analytics and operations across ecommerce‚ÄîMytheresa, Bang & Olufsen, reMarkable. I've worked on funnels, experimentation, and the messy process of turning data into decisions. My titles haven't always matched what I actually did, which was helping product and commercial teams figure out what matters and what to do about it.`;
            }

            // PROOF: One specific, compelling example
            let proof = '';
            if (/experiment|a\/b|test/.test(jd)) {
                proof = `Here's an example of how I work: at Mytheresa, I ran an A/B test where the variant everyone expected to win actually hurt downstream metrics‚Äîrepeat purchase rate dropped. The aggregate conversion number looked good, but the cohort behavior told a different story. Presenting that finding required more than just showing data; I had to help stakeholders understand why the "losing" option was actually the right call. That ability to defend counterintuitive results‚Äîand build trust in the process‚Äîis something I'd bring to ${company}.`;
            } else if (/prioriti|roadmap|backlog/.test(jd)) {
                proof = `At Mytheresa, I'm often the person in the room when product teams are deciding what to fix next. My job is to turn a list of ten problems into a clear recommendation on which two actually matter. That means quantifying impact, yes, but also understanding constraints‚Äîwhat the team can realistically ship, what dependencies exist, what the business actually needs right now. I've learned that good prioritization is as much about framing the question as crunching the numbers.`;
            } else if (/stakeholder|cross-functional/.test(jd)) {
                proof = `At Bang & Olufsen, I worked with market heads across five regions‚Äîeach with different priorities, different local contexts, and different ideas about what the data should say. I learned to translate insights into language that made sense for each audience, and to push back constructively when someone wanted the data to tell a story it didn't support. That experience‚Äîbuilding alignment across stakeholders who don't report to each other‚Äîwould transfer directly to this role.`;
            } else if (/customer|user|experience|csat|nps/.test(jd)) {
                proof = `At Bang & Olufsen, I led a project analyzing customer feedback across touchpoints. The quantitative data showed where drop-offs happened, but the qualitative feedback revealed why. We identified systemic issues that weren't obvious from metrics alone‚Äîand fixing them moved CSAT from 65% to 85%. That combination of qual and quant, and the persistence to follow problems to root causes, is something I'd bring to ${company}.`;
            } else if (/funnel|conversion|drop-off/.test(jd)) {
                proof = `At Mytheresa, I own the process of investigating funnel anomalies. When conversion drops, I'm the one figuring out whether it's a bug, a tracking issue, a seasonal pattern, or a real behavior change. That diagnostic work‚Äîand knowing how to prioritize what to fix based on actual impact‚Äîis something I've gotten good at. I'd bring that same rigor to understanding what's happening in ${company}'s funnel and what to do about it.`;
            } else {
                proof = `Here's how I tend to work: at Bang & Olufsen, I was asked to analyze campaign performance across global markets. Instead of just building a dashboard, I dug into why certain markets outperformed others‚Äîand found that the difference wasn't the campaigns, it was inventory availability affecting what we could actually sell. That insight changed how the commercial team thought about planning. I look for those non-obvious connections, and I'd bring that approach to ${company}.`;
            }

            // FIT: Why you + them specifically
            let fit = '';
            if (isPM) {
                fit = `I know my path to product management is non-traditional‚ÄîI'm coming from analytics, not a PM rotation or MBA. But I'd argue that's a strength. I won't make decisions based on intuition and call it "product sense." I'll make them based on evidence, and I'll be able to explain why. ${company} seems like a place that values that approach.`;
            } else if (isGrowth) {
                fit = `What I'd bring to ${company} is a clear-eyed view of what actually moves growth metrics versus what just feels productive. I've seen enough experiments fail to know that conviction without validation is expensive. And I've built the muscle to communicate trade-offs in a way that helps teams commit to a direction.`;
            } else {
                fit = `What I'd bring to this role is the ability to connect data to decisions‚Äînot just surface insights, but frame them in a way that leads to action. I've done this across multiple companies and contexts, and I'm looking for a place where that skill has real leverage. ${company} seems like that place.`;
            }

            // CLOSE: Confident, not groveling
            const close = `I'd welcome a conversation about how my background fits what you're building.`;

            // ASSEMBLE
            const letter = `Dear Hiring Team,

${opening}

${context}

${proof}

${fit}

${close}

Best,
Jan Skaaden
janskaaden@gmail.com | +34 663 471 415
linkedin.com/in/janskaaden`;

            document.getElementById('coverLetter').innerText = letter;
            document.getElementById('output').classList.add('visible');
            document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard() {
            const text = document.getElementById('coverLetter').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úì Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy to Clipboard', 2000);
            });
        }

        function downloadPDF() {
            const company = document.getElementById('company').value.trim() || 'Company';
            const role = document.getElementById('role').value.trim() || 'Role';
            const letterText = document.getElementById('coverLetter').innerText;

            // Clean up names for filename
            const cleanCompany = company.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
            const cleanRole = role.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
            const filename = `Jan_Skaaden_${cleanCompany}_${cleanRole}.pdf`;

            // Create a styled container for PDF
            const pdfContent = document.createElement('div');
            pdfContent.style.fontFamily = 'Georgia, serif';
            pdfContent.style.fontSize = '12pt';
            pdfContent.style.lineHeight = '1.6';
            pdfContent.style.padding = '40px';
            pdfContent.style.maxWidth = '600px';
            pdfContent.style.color = '#1a1a1a';
            pdfContent.innerHTML = letterText.replace(/\n/g, '<br>');

            // PDF options
            const opt = {
                margin: [15, 15, 15, 15],
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Generate and download
            html2pdf().set(opt).from(pdfContent).save();
        }
    </script>
</body>
</html>
