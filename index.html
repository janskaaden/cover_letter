<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cover Letter Generator - Jan Skaaden</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        h1 { color: #1a1a1a; margin-bottom: 8px; }
        .subtitle { color: #666; margin-bottom: 32px; }
        .card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .card h2 { margin-top: 0; font-size: 18px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; color: #444; }
        .label-hint { font-weight: normal; color: #666; font-size: 13px; }
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        textarea:focus, input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #94a3b8; cursor: wait; }
        .btn-small { padding: 10px 16px; font-size: 14px; }
        .btn-green { background: #059669; }
        .btn-green:hover { background: #047857; }
        .btn-purple { background: #6366f1; }
        .btn-purple:hover { background: #4f46e5; }
        .btn-red { background: #dc2626; }
        .btn-red:hover { background: #b91c1c; }
        .btn-row { display: flex; gap: 8px; margin-top: 12px; }
        .btn-row button { flex: 1; }
        .inference {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .inference.visible { display: block; }
        .inference h3 { margin: 0 0 16px 0; font-size: 15px; color: #92400e; }
        .inference-section { margin-bottom: 16px; }
        .inference-section:last-child { margin-bottom: 0; }
        .inference-section strong { display: block; font-size: 12px; color: #78350f; text-transform: uppercase; margin-bottom: 6px; }
        .inference-section p { margin: 0; font-size: 14px; color: #451a03; }
        .output { display: none; }
        .output.visible { display: block; }
        #coverLetter {
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.8;
            background: #fafafa;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            min-height: 300px;
        }
        #coverLetter[contenteditable]:focus {
            outline: none;
            border-color: #2563eb;
            background: white;
        }
        .actions { display: flex; gap: 12px; margin-top: 16px; }
        .actions button { flex: 1; }
        .edit-hint { font-size: 13px; color: #666; margin-bottom: 8px; }
        .guidelines {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .guidelines strong { color: #166534; }
        .guidelines ul { margin: 8px 0 0 0; padding-left: 20px; color: #15803d; }
        .fetch-status {
            font-size: 13px;
            margin-top: 10px;
            padding: 10px 14px;
            border-radius: 6px;
            display: none;
        }
        .fetch-status.loading { display: block; background: #dbeafe; color: #1e40af; }
        .fetch-status.success { display: block; background: #dcfce7; color: #166534; }
        .fetch-status.error { display: block; background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <h1>Cover Letter Generator</h1>
    <p class="subtitle">Direct, human cover letters that win interviews</p>

    <div class="guidelines">
        <strong>‚úì What this generates:</strong>
        <ul>
            <li>Short paragraphs, direct sentences</li>
            <li>One specific example with a real outcome</li>
            <li>Clear value proposition (what they get)</li>
            <li>Confident close, no groveling</li>
            <li>No "passionate," "excited to apply," or corporate fluff</li>
        </ul>
    </div>

    <div class="card">
        <h2>1. Company & Role</h2>
        <div class="row">
            <div>
                <label for="company">Company Name *</label>
                <input type="text" id="company" placeholder="e.g., Spotify">
            </div>
            <div>
                <label for="role">Role Title *</label>
                <input type="text" id="role" placeholder="e.g., Growth PM">
            </div>
        </div>
        <div class="btn-row">
            <button class="btn-small btn-green" onclick="fetchFromWikipedia()" id="wikiBtn">üîç Fetch Company Info (Wikipedia)</button>
        </div>
        <div id="fetchStatus" class="fetch-status"></div>
    </div>

    <div class="card">
        <h2>2. Job Description *</h2>
        <label for="jobDesc">Paste the full job posting</label>
        <textarea id="jobDesc" rows="10" placeholder="Paste the job description here..."></textarea>
    </div>

    <div class="card">
        <h2>3. Company Context <span class="label-hint">(auto-filled or paste manually)</span></h2>
        <label for="companyContext">What does the company do?</label>
        <textarea id="companyContext" rows="3" placeholder="e.g., EdTech marketplace connecting students with tutors. Series C, 500 employees..."></textarea>
    </div>

    <div class="card">
        <button onclick="generateLetter()">‚ú® Generate Cover Letter</button>
    </div>

    <div id="inference" class="inference">
        <h3>üß† Reading between the lines:</h3>
        <div class="inference-section">
            <strong>What they actually want</strong>
            <p id="inferValues"></p>
        </div>
        <div class="inference-section">
            <strong>Problems this hire solves</strong>
            <p id="inferProblems"></p>
        </div>
        <div class="inference-section">
            <strong>Your angle</strong>
            <p id="inferFit"></p>
        </div>
    </div>

    <div id="output" class="output">
        <div class="card">
            <h2>Your Cover Letter</h2>
            <p class="edit-hint">üí° Click to edit. Add any specific details you know.</p>
            <div id="coverLetter" contenteditable="true"></div>
            <div class="actions">
                <button class="btn-green" onclick="copyToClipboard()">üìã Copy</button>
                <button class="btn-red" onclick="downloadPDF()">üìÑ Download PDF</button>
                <button class="btn-purple" onclick="generateLetter()">üîÑ Regenerate</button>
            </div>
        </div>
    </div>

    <script>
        // =====================================================================
        // FETCH COMPANY INFO FROM WIKIPEDIA
        // =====================================================================

        async function fetchFromWikipedia() {
            const company = document.getElementById('company').value.trim();
            const status = document.getElementById('fetchStatus');
            const btn = document.getElementById('wikiBtn');

            if (!company) {
                status.className = 'fetch-status error';
                status.textContent = 'Please enter a company name first.';
                return;
            }

            btn.disabled = true;
            status.className = 'fetch-status loading';
            status.textContent = `Searching for "${company}"...`;

            try {
                const searchUrl = `https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(company)}&limit=5&namespace=0&format=json&origin=*`;
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();

                const titles = searchData[1];
                if (!titles || titles.length === 0) throw new Error('Not found');

                let bestTitle = titles[0];
                const descriptions = searchData[2];

                for (let i = 0; i < titles.length; i++) {
                    const desc = (descriptions[i] || '').toLowerCase();
                    if (desc.includes('company') || desc.includes('corporation') || desc.includes('software') || desc.includes('technology')) {
                        bestTitle = titles[i];
                        break;
                    }
                }

                const summaryUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(bestTitle)}`;
                const summaryResponse = await fetch(summaryUrl);
                if (!summaryResponse.ok) throw new Error('Failed');

                const summaryData = await summaryResponse.json();
                let companyInfo = summaryData.extract || '';
                if (summaryData.description) {
                    companyInfo = summaryData.description + '. ' + companyInfo;
                }

                if (companyInfo.length > 1200) companyInfo = companyInfo.substring(0, 1200) + '...';

                document.getElementById('companyContext').value = companyInfo;
                status.className = 'fetch-status success';
                status.textContent = `‚úì Found "${bestTitle}"`;

            } catch (error) {
                status.className = 'fetch-status error';
                status.textContent = `Couldn't find "${company}" on Wikipedia. Try different spelling or paste info manually.`;
            }

            btn.disabled = false;
        }

        // =====================================================================
        // INFERENCE ENGINE
        // =====================================================================

        function inferRoleNeeds(jobDesc, companyContext, role) {
            const jd = jobDesc.toLowerCase();
            const ctx = companyContext.toLowerCase();

            let values = [];
            if (/experiment|a\/b|test|data-driven/.test(jd)) values.push("decisions backed by data, not gut");
            if (/growth|acquisition|retention/.test(jd)) values.push("measurable impact on metrics");
            if (/stakeholder|cross-functional/.test(jd)) values.push("influence without authority");
            if (/prioriti|trade-off|focus/.test(jd)) values.push("ability to say no with evidence");
            if (/fast|startup|scrappy/.test(jd + ctx)) values.push("bias to action");
            if (values.length === 0) values.push("someone who turns data into decisions");

            let problems = [];
            if (/growth|conversion|funnel/.test(jd)) problems.push("growth has stalled, need diagnosis");
            if (/experiment|a\/b/.test(jd)) problems.push("running tests but not learning systematically");
            if (/prioriti|roadmap/.test(jd)) problems.push("too many ideas, not enough focus");
            if (/stakeholder|align/.test(jd)) problems.push("teams making decisions in silos");
            if (problems.length === 0) problems.push("need someone to connect data to action");

            let fit = [];
            const isPM = /product manager/i.test(role);
            const isGrowth = /growth/i.test(role);
            if (isPM) fit.push("Analytics background = decisions with evidence, not just instinct");
            if (isGrowth) fit.push("You know what actually moves metrics vs. what looks good in decks");
            if (/ecommerce/.test(jd + ctx)) fit.push("Direct ecommerce experience at luxury brands");
            if (/experiment/.test(jd)) fit.push("You've defended counterintuitive test results");
            if (fit.length === 0) fit.push("Four years connecting data to decisions in ecommerce");

            return {
                values: values.slice(0, 2).join("; "),
                problems: problems.slice(0, 2).join("; "),
                fit: fit.slice(0, 2).join(". ")
            };
        }

        // =====================================================================
        // LETTER GENERATION - Human, direct, no AI-speak
        // =====================================================================

        function generateLetter() {
            const company = document.getElementById('company').value.trim();
            const role = document.getElementById('role').value.trim();
            const jobDesc = document.getElementById('jobDesc').value.trim();
            const companyContext = document.getElementById('companyContext').value.trim();

            if (!company || !role || !jobDesc) {
                alert('Please fill in company name, role title, and job description.');
                return;
            }

            const jd = jobDesc.toLowerCase();
            const ctx = companyContext.toLowerCase();

            // Show inference
            const inference = inferRoleNeeds(jobDesc, companyContext, role);
            document.getElementById('inference').classList.add('visible');
            document.getElementById('inferValues').textContent = inference.values;
            document.getElementById('inferProblems').textContent = inference.problems;
            document.getElementById('inferFit').textContent = inference.fit;

            // Detect role type and themes
            const isPM = /product manager|product owner/i.test(role);
            const isGrowth = /growth/i.test(role);
            const isMarketing = /marketing/i.test(role);
            const isAnalyst = /analyst/i.test(role);

            const hasExperimentation = /experiment|a\/b|test|hypothesis/.test(jd);
            const hasStakeholders = /stakeholder|cross-functional|collaborate/.test(jd);
            const hasFunnel = /funnel|conversion|drop-off|journey/.test(jd);
            const hasPrioritization = /prioriti|roadmap|backlog|trade-off/.test(jd);
            const hasCX = /customer experience|csat|nps|feedback/.test(jd);

            // =====================================================================
            // BUILD LETTER - Short paragraphs, direct language
            // =====================================================================

            let paragraphs = [];

            // OPENER: Show relevance immediately
            if (hasExperimentation) {
                paragraphs.push(`Four years of running experiments in ecommerce. At Mytheresa, I own A/B testing and funnel analytics. At Bang & Olufsen, I measured what drove conversion across five markets. The ${role} role at ${company} looks like a place where that experience matters.`);
            } else if (isGrowth || isMarketing) {
                paragraphs.push(`Four years in ecommerce taught me what actually moves growth metrics. At Bang & Olufsen, I helped commercial teams across five regions figure out which campaigns to scale and which to cut. At Mytheresa, I run funnel analytics and experimentation. That's the experience I'd bring to ${company}.`);
            } else if (isPM) {
                paragraphs.push(`Four years as the analytics person in the room when product teams decide what to build. At Mytheresa, I help prioritize the backlog by sizing impact. At Bang & Olufsen, I turned data into recommendations that commercial leads acted on. I'm looking to own more of those decisions. That's why ${company} caught my attention.`);
            } else if (hasStakeholders) {
                paragraphs.push(`The ${role} role at ${company} stood out because it's about influence, not just analysis. At Bang & Olufsen, I worked with market heads across five regions who disagreed on priorities. My job was to give them a shared view of what the data said. At Mytheresa, I'm the link between product and commercial when something breaks in the funnel.`);
            } else {
                paragraphs.push(`Four years turning ecommerce data into decisions. At Mytheresa, I run experimentation and funnel analytics. At Bang & Olufsen, I helped commercial teams across five markets figure out what was working. The ${role} role at ${company} looks like a place where that experience translates.`);
            }

            // PROOF: One specific example with outcome
            if (hasExperimentation) {
                paragraphs.push(`Example: I ran a test at Mytheresa where the winning variant had higher conversion but lower repeat purchase rate. Everyone wanted to ship it. I showed the cohort data and argued for the "losing" variant. Three months later, that call was worth more in retained revenue than the conversion lift would have been. I'm good at finding those trade-offs.`);
            } else if (hasCX || /feedback|support|customer/.test(jd)) {
                paragraphs.push(`At Bang & Olufsen, I analyzed customer feedback and found our biggest drop-off wasn't where we thought. We were fixing checkout friction while the real problem was post-purchase communication. Fixing that moved CSAT from 65% to 85%. I look for the problem behind the problem.`);
            } else if (hasFunnel) {
                paragraphs.push(`At Mytheresa, when conversion drops, I figure out why. Last quarter I traced a 3% drop to a tracking bug miscounting mobile sessions. The week before, a similar drop was real‚Äîa payment issue in Germany. Knowing the difference saves time and money. I've built that instinct over four years.`);
            } else if (hasStakeholders) {
                paragraphs.push(`At Bang & Olufsen, five regional market heads all had different views on what the data meant. My job was to build alignment without watering down the findings. I learned to present trade-offs clearly enough that people could disagree with my recommendation but not with the facts.`);
            } else if (hasPrioritization) {
                paragraphs.push(`At Mytheresa, I'm often in the room when product decides what to fix. My job is to turn ten problems into two priorities. That means sizing impact, yes, but also knowing what's realistic to ship. Good prioritization is mostly about asking the right question.`);
            } else {
                paragraphs.push(`At Bang & Olufsen, I was asked why some markets outperformed others. Everyone assumed it was the campaigns. I dug in and found the real driver was inventory‚Äîwe were advertising products we couldn't ship. That insight changed how commercial planning worked. I look for those non-obvious answers.`);
            }

            // VALUE PROP: What they get
            if (isPM) {
                paragraphs.push(`I don't have a traditional PM background. I'm coming from analytics. That means I won't make decisions based on gut and call it product sense. Every recommendation will have evidence behind it.`);
            } else if (isGrowth || isMarketing) {
                paragraphs.push(`What you'd get: someone who knows what actually drives growth versus what just feels productive. I've seen enough failed experiments to know that conviction without data is expensive.`);
            } else if (isAnalyst) {
                paragraphs.push(`What I add is the ability to turn analysis into action. I've worked with enough teams to know that insight without influence is just noise. I make sure my work changes decisions.`);
            } else {
                paragraphs.push(`What I bring: the ability to connect data to decisions. Not dashboards and reports, but recommendations teams act on. I've done this across three companies in ecommerce.`);
            }

            // CLOSE: Confident, one line
            paragraphs.push(`Let's talk.`);

            // ASSEMBLE
            const letter = `Hi,

${paragraphs.join('\n\n')}

Jan Skaaden
janskaaden@gmail.com
+34 663 471 415
linkedin.com/in/janskaaden`;

            document.getElementById('coverLetter').innerText = letter;
            document.getElementById('output').classList.add('visible');
            document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
        }

        // =====================================================================
        // COPY & DOWNLOAD
        // =====================================================================

        function copyToClipboard() {
            const text = document.getElementById('coverLetter').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.btn-green');
                btn.textContent = '‚úì Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy', 2000);
            });
        }

        function downloadPDF() {
            const company = document.getElementById('company').value.trim() || 'Company';
            const role = document.getElementById('role').value.trim() || 'Role';
            const letterText = document.getElementById('coverLetter').innerText;

            const cleanCompany = company.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
            const cleanRole = role.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
            const filename = `Jan_Skaaden_${cleanCompany}_${cleanRole}.pdf`;

            const pdfContent = document.createElement('div');
            pdfContent.style.fontFamily = 'Georgia, serif';
            pdfContent.style.fontSize = '11pt';
            pdfContent.style.lineHeight = '1.5';
            pdfContent.style.padding = '20px';
            pdfContent.style.maxWidth = '650px';
            pdfContent.style.color = '#1a1a1a';
            pdfContent.innerHTML = letterText.replace(/\n/g, '<br>');

            const opt = {
                margin: [15, 20, 15, 20],
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(pdfContent).save();
        }
    </script>
</body>
</html>
